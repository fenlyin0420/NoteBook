# 各层数据包格式

![IP数据报格式](IP数据报格式.md)


# 特殊IP地址
- 网络号全零，此时主机号一般也应全零，`0.0.0.0`表示任意网络，类似于通配符
- 网络号全1，此时主机号一般也应全1，`255.255.255.255`有限广播地址（不常见）
- 主机号全0，`192.168.1.0/24`表示网络地址
- 主机号全1，`192.168.1.255/24`表示该子网内的广播地址


工作在二层及一下的设备是没有IP地址的，例如二层交换机，它根据MAC地址转发数据包，而三层交换机，每一个网络接口都有一个IP地址。


```
Proto  Local Address     Foreign Address         State
tcp    127.0.0.1:8000    0.0.0.0:*               LISTEN
tcp    192.168.1.10:22   192.168.1.15:56789      ESTABLISHED
udp    0.0.0.0:68        0.0.0.0:*
```
- 第一行看似允许外部所有IP地址请求，但因为本地地址的特殊性，外部根本无法访问这个地址（回环地址），所以此行实质上只能监听到来自本机回环地址发往`127.0.0.1:8000`的请求
- 第二行表示`192.168.1.15:56789`已与本机`192.168.1.10:22`建立了连接
- 第三行监听外部任意地址发往本地任意地址的68端口的请求，udp是无连接的，所以State栏为空


```
tcp 0 80 172.24.200.6:22 36.142.55.128:29302 ESTABLISHED 
tcp 0 0  172.24.200.6:22 36.142.55.128:29480 ESTABLISHED 
tcp 0 0  172.24.200.6:22 36.142.55.128:29571 ESTABLISHED
```
TCP实现了多路复用技术，可以在一个端口上建立多个连接，每一个连接都使用四元组唯一标识：（源地址，源端口，目的地址，目的端口）。
![](Pasted%20image%2020241021111315.png)
Foreign Address 被渲染为域名了，因为Docker Dosktop修改了我的 hosts 文件，将 `127.0.0.1`对应为了 kubernetes。`netstat`对 Foreign Address 默认使用域名渲染输出，这样会使命名执行时间变长，因为对于外部（非本地）网络连接，netstat 不得不花一些时间去域名解析。

如果你的电脑设置了名称，那么`localhost`这个域名会被替换为你的电脑名称。所以，如果你的hosts文件中 127.0.0.1 对应的是 localhost，你也不会看到localhost，而是你的电脑名称。


# PDU
在网络通信中，**PDU（Protocol Data Unit，协议数据单元）** 是指在特定网络层中传输的数据单元。它是网络协议栈中每一层处理和传输的基本单位。每一层都有自己的PDU，并且每一层的PDU在传输过程中可能会被封装或解封装。

### 不同网络层中的PDU
在OSI（开放系统互连）模型或TCP/IP模型中，每一层都有其特定的PDU名称：

1. **物理层（Physical Layer）**  
   PDU：**比特（Bit）**  
   这一层处理的是原始的二进制数据流（0和1）。

2. **数据链路层（Data Link Layer）**  
   PDU：**帧（Frame）**  
   数据链路层将比特流组织成帧，帧中包含源MAC地址、目的MAC地址以及校验信息（如CRC）。

3. **网络层（Network Layer）**  
   PDU：**数据包（Packet）**  
   网络层负责将数据封装成数据包，数据包中包含源IP地址、目的IP地址以及路由信息。

4. **传输层（Transport Layer）**  
   PDU：**段（Segment，TCP）或数据报（Datagram，UDP）**  
   • 在TCP协议中，传输层的PDU称为段（Segment），包含源端口、目的端口、序列号、确认号等信息。  
   • 在UDP协议中，传输层的PDU称为数据报（Datagram），包含源端口、目的端口和长度等信息。

5. **会话层（Session Layer）**  
   PDU：**数据（Data）**  
   会话层负责建立、管理和终止会话，其PDU通常称为数据。

6. **表示层（Presentation Layer）**  
   PDU：**数据（Data）**  
   表示层负责数据的格式化、加密和压缩，其PDU也称为数据。

7. **应用层（Application Layer）**  
   PDU：**数据（Data）**  
   应用层直接与用户交互，其PDU也称为数据。

### PDU的封装与解封装
在数据传输过程中，数据从上层向下层传递时，每一层都会添加自己的头部（和尾部，如帧中的CRC）信息，这个过程称为**封装**。当数据从下层向上层传递时，每一层会移除自己的头部信息，这个过程称为**解封装**。

例如，当应用层的数据传递到传输层时，传输层会添加TCP或UDP头部，形成段或数据报；传递到网络层时，网络层会添加IP头部，形成数据包；传递到数据链路层时，数据链路层会添加MAC头部和尾部，形成帧；最后传递到物理层，转换为比特流传输。

### 总结
PDU是网络协议栈中每一层处理和传输的基本单位，每一层的PDU名称不同，封装的内容也不同。理解PDU有助于更好地掌握网络通信的工作原理。

10 0001 1100 0100
1000 0001 1100 0100 

