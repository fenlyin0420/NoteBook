子骨骼如果与父骨骼连接(connected)，则其无法移动，只能绕父骨骼的尾(也即自己的头)旋转；如果与父骨骼是分开的(keep offset)，则其可以自由移动。
## 骨骼挤出

![[Pasted image 20241209135129.png]]
一个骨骼从它头部挤出的骨骼是兄弟，从尾部挤出的是孩子。



# 骨骼控制器
本质就是改变了骨骼显示的样式，这样在k帧时，首先看起来比较简介，其次，操作更方便。


# 骨骼变换原理

一个骨骼相当于一个仿射变换矩阵，对其权重大于0的所有顶点，在自身的坐标系下，依次应用一次变换并乘以对该顶点的权重。

一个顶点的如果受多个骨骼控制，每个骨骼变换前，会先将顶点从全局坐标转换到自己的局部坐标，变换后，再转换回全局坐标，顶点最终的坐标是所有骨骼变换后全局坐标的累加。

使用python和grandio框架完成一个`仿射变换计算器`
功能：
- 支持3d和2d仿射变换
- 计算过程全称使用齐次坐标
- 用户输入坐标， 选择具体的变换后（变换和参数），点击`计算`按钮，即可得到经过变换后的坐标
- 可以很轻易的一次完成多次变换，用户先指定的变换计算式先变换。
- 用户指定玩变换序列后，还可以在中间插入或删除变换。


你需要修改的问题：
- 输入坐标控件：希望有几个坐标轴，就提供多少个输入框，并指明该框所属的坐标轴，并且希望可以提供更复杂的输入模式，例如，应该很轻易的让用户能够输入根号等一些数学符号。
- 当用户选择变换类型后，后边控件只提供与该变换类型有关的参数，例如，用户选择了平移变换后，就不应该再出现跟旋转有关的参数了。
- 当用户添加完一个变换后，应该能显示出当前已添加的所有变换。
- 用户可以再以添加的变换序列中插入新的变换。
- 用户可以点击以添加的变换，进行删除、修改等操作。

非常棒！现在，让我们继续优化这个项目。现在有如下需求：
- 变换序列显示上需要更直观、更“图形化”一些，具体为：
	- 每一个变换被边框包围，边框可以艺术一些，框内可以有背景颜色（要美观，最好为浅色调）
	- 框内以文字的形式显示变换的内容
	- 每一个变换的宽度，高度要固定，这样显得更整齐一些
	- 变换序列从左往右显示
	- 当用户点击“添加变换”后，该变换默认添加到最左边，相应的，之前的变换序列整体要右移，以为新的变换流出空间
	- 当一行不足以显示时，换行
	- 用户可以对每一个变换（视图上为变换框）进行操作，当点击方框后，方框右上角出现`x` 号，点击可以删除该变换
	- 用户可以对每一个变换框进行拖动，当用户拖动某个一变换框到两个变换框之间时，可以自动将拖动的变换框插入到那两个变换框之间，即通过拖动的方式改变变换顺序。
注意：经过上述修改后，之前的"插入位置（可选）"和"要删除的变换序号"等控件就应该被移除了

效果还不错！  
但还存在一些问题：  
1. 点击变换框右上角的`x`后无反应，无法成功删除对应变换，变换框依旧显示。希望点击后变换框消失，同时删除该变换；  
2. 变换框可以拖动，但是无法自动插入目标位置。希望拖动变换框到可以插入的位置后，可以对变换框进行缩小，以提示用户改进地方可以插入；移出可以插入的位置后，恢复原来的大小；松开按钮后，插入！

可以插入的地方：
1. 序列的最末尾，即最后一次的变换，第一行的最左边
2. 框与框的中间部分
3. 序列的最开头，即第一次的变换，最后一行的末尾
4. 每一行的末尾

